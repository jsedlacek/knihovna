---
// This runs at build time on the server
import fs from "fs";
import path from "path";
import Layout from "#@/layouts/layout.astro";
import HomePage from "#@/components/home-page.tsx";
import { loadScrapingTimestamp } from "#@/lib/server/utils/timestamp-utils.ts";

// Read the books data at build time
const booksPath = path.join(process.cwd(), "data", "books.json");
let books = [];

try {
    const booksData = fs.readFileSync(booksPath, "utf-8");
    books = JSON.parse(booksData);
} catch (error) {
    console.warn(
        "Could not read books.json, using empty array:",
        error instanceof Error ? error.message : String(error),
    );
}

// Read the timestamp data at build time
const lastUpdated = await loadScrapingTimestamp();
---

<Layout title="Nejlepší e-knihy zdarma">
    <HomePage books={books} lastUpdated={lastUpdated} client:load />
</Layout>
